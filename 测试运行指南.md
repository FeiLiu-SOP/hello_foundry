# Foundry æµ‹è¯•è¿è¡ŒæŒ‡å— - Java å¼€å‘è€…è§†è§’

## ğŸ”„ Java vs Solidity æµ‹è¯•å¯¹æ¯”

### Java æµ‹è¯•ï¼ˆJUnitï¼‰
```java
// UserServiceTest.java
public class UserServiceTest {
    @BeforeEach
    void setUp() { ... }
    
    @Test
    void testCreateUser() { ... }  // å¯ä»¥å•ç‹¬è¿è¡Œè¿™ä¸ªæµ‹è¯•
    
    @Test
    void testDeleteUser() { ... }  // å¯ä»¥å•ç‹¬è¿è¡Œè¿™ä¸ªæµ‹è¯•
}
```

### Solidity æµ‹è¯•ï¼ˆFoundryï¼‰
```solidity
// UserService.t.sol
contract UserServiceTest is Test {
    function setUp() public { ... }
    
    function test_CreateUser() public { ... }  // å¯ä»¥å•ç‹¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼
    
    function test_DeleteUser() public { ... }  // å¯ä»¥å•ç‹¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼
}
```

**å…³é”®ç‚¹ï¼šä¸¤è€…å…¶å®æ˜¯ä¸€æ ·çš„ï¼** æ¯ä¸ª `test_` å¼€å¤´çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹ã€‚

## ğŸ¯ å¦‚ä½•å•ç‹¬è¿è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹

### æ–¹æ³•1ï¼šä½¿ç”¨ `--match-test`ï¼ˆæœ€å¸¸ç”¨ï¼Œæœ€ç²¾å‡†ï¼‰

```bash
# åªè¿è¡Œ test_Prank_SimulateHacker_ShouldFail è¿™ä¸€ä¸ªæµ‹è¯•
forge test --match-test test_Prank_SimulateHacker_ShouldFail

# åªè¿è¡Œ test_Prank_SimulateOwner è¿™ä¸€ä¸ªæµ‹è¯•
forge test --match-test test_Prank_SimulateOwner

# ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¤šä¸ªæµ‹è¯•
forge test --match-test "test_Prank.*"  # è¿è¡Œæ‰€æœ‰ test_Prank å¼€å¤´çš„æµ‹è¯•
```

### æ–¹æ³•2ï¼šä½¿ç”¨ `--match-contract` + `--match-test`ï¼ˆæ›´ç²¾ç¡®ï¼‰

```bash
# åœ¨ SimpleWalletTest åˆçº¦ä¸­ï¼Œåªè¿è¡Œ test_Prank_SimulateHacker_ShouldFail
forge test --match-contract SimpleWalletTest --match-test test_Prank_SimulateHacker_ShouldFail
```

### æ–¹æ³•3ï¼šä½¿ç”¨ `--match-path` + `--match-test`ï¼ˆæœ€ç²¾ç¡®ï¼‰

```bash
# åœ¨æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œåªè¿è¡ŒæŒ‡å®šçš„æµ‹è¯•å‡½æ•°
forge test --match-path test/SimpleWallet.t.sol --match-test test_Prank_SimulateHacker_ShouldFail
```

## ğŸ“Š åº•å±‚é€»è¾‘è§£æ

### Foundry æµ‹è¯•çš„æ‰§è¡Œæµç¨‹

```
1. ç¼–è¯‘æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ (*.t.sol)
   â†“
2. æ‰¾åˆ°æ‰€æœ‰ä»¥ test_ å¼€å¤´çš„å‡½æ•°ï¼ˆæˆ–è€… testFuzz_, testInvariant_ï¼‰
   â†“
3. å¯¹æ¯ä¸ªæµ‹è¯•å‡½æ•°ï¼š
   a. éƒ¨ç½²æµ‹è¯•åˆçº¦ï¼ˆSimpleWalletTestï¼‰
   b. è°ƒç”¨ setUp() å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
   c. è°ƒç”¨æµ‹è¯•å‡½æ•°ï¼ˆå¦‚ test_Prank_SimulateHacker_ShouldFailï¼‰
   d. æ£€æŸ¥æ–­è¨€æ˜¯å¦é€šè¿‡
   â†“
4. è¾“å‡ºç»“æœ
```

### ä¸ºä»€ä¹ˆä¸€ä¸ªæ–‡ä»¶åŒ…å«å¤šä¸ªæµ‹è¯•ï¼Ÿ

**åŸå› 1ï¼šå…±äº« setUp()**
```solidity
contract SimpleWalletTest is Test {
    SimpleWallet public wallet;  // æ‰€æœ‰æµ‹è¯•å…±äº«è¿™ä¸ªå˜é‡
    
    function setUp() public {
        wallet = new SimpleWallet(owner);  // æ¯ä¸ªæµ‹è¯•å‰éƒ½ä¼šæ‰§è¡Œ
        vm.deal(address(wallet), 100 ether);
    }
    
    // æ‰€æœ‰æµ‹è¯•éƒ½ä½¿ç”¨åŒä¸€ä¸ª wallet å®ä¾‹ï¼ˆä½†æ¯æ¬¡æµ‹è¯•éƒ½ä¼šé‡æ–° setUpï¼‰
    function test_1() public { ... }
    function test_2() public { ... }
}
```

**åŸå› 2ï¼šæµ‹è¯•éš”ç¦»**
- æ¯ä¸ªæµ‹è¯•å‡½æ•°è¿è¡Œå‰ï¼Œéƒ½ä¼šï¼š
  1. é‡æ–°éƒ¨ç½²æµ‹è¯•åˆçº¦
  2. é‡æ–°æ‰§è¡Œ setUp()
  3. çŠ¶æ€å®Œå…¨éš”ç¦»ï¼ˆå°±åƒ Java çš„ @BeforeEachï¼‰

**åŸå› 3ï¼šç»„ç»‡ç®¡ç†**
- ç›¸å…³æµ‹è¯•æ”¾åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤
- ç±»ä¼¼ Java ä¸­ä¸€ä¸ªæµ‹è¯•ç±»åŒ…å«å¤šä¸ª @Test æ–¹æ³•

## ğŸ’¼ å·¥ä½œä¸­çš„æœ€ä½³å®è·µ

### 1. å¼€å‘æ—¶ï¼šåªè¿è¡Œå½“å‰æ­£åœ¨å†™çš„æµ‹è¯•

```bash
# å†™ test_Prank_SimulateHacker æ—¶ï¼Œåªè¿è¡Œè¿™ä¸ªæµ‹è¯•
forge test --match-test test_Prank_SimulateHacker -vvv

# -vvv æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•
```

### 2. æäº¤å‰ï¼šè¿è¡Œæ‰€æœ‰ç›¸å…³æµ‹è¯•

```bash
# è¿è¡Œ SimpleWallet çš„æ‰€æœ‰æµ‹è¯•
forge test --match-path test/SimpleWallet.t.sol

# æˆ–è€…è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test
```

### 3. CI/CDï¼šè¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# åœ¨ CI ä¸­è¿è¡Œæ‰€æœ‰æµ‹è¯•
forge test
```

### 4. è°ƒè¯•å•ä¸ªå¤±è´¥æµ‹è¯•

```bash
# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•ï¼ŒæŸ¥çœ‹è¯¦ç»†è¾“å‡º
forge test --match-test test_Prank_SimulateHacker_ShouldFail -vvvv

# -vvvv æ˜¾ç¤ºæœ€è¯¦ç»†çš„æ—¥å¿—ï¼ŒåŒ…æ‹¬ gas ä½¿ç”¨æƒ…å†µ
```

## ğŸ” å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨

| åœºæ™¯ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| è¿è¡Œæ‰€æœ‰æµ‹è¯• | `forge test` | ç±»ä¼¼ `mvn test` |
| è¿è¡Œå•ä¸ªæµ‹è¯• | `forge test --match-test test_XXX` | ç±»ä¼¼è¿è¡Œå•ä¸ª @Test |
| è¿è¡Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰æµ‹è¯• | `forge test --match-path test/XXX.t.sol` | ç±»ä¼¼è¿è¡Œæ•´ä¸ªæµ‹è¯•ç±» |
| è¿è¡ŒåŒ¹é…æ¨¡å¼çš„æµ‹è¯• | `forge test --match-test "test_Prank.*"` | è¿è¡Œæ‰€æœ‰åŒ¹é…çš„æµ‹è¯• |
| è¯¦ç»†è¾“å‡º | `forge test -vvv` | æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— |
| æœ€è¯¦ç»†è¾“å‡º | `forge test -vvvv` | æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ gas |

## ğŸ“ å®é™…ä¾‹å­

### åœºæ™¯1ï¼šä½ æ­£åœ¨å†™ test_Prank_SimulateHacker_ShouldFail

```bash
# 1. åªè¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼Œå¿«é€Ÿè¿­ä»£
forge test --match-test test_Prank_SimulateHacker_ShouldFail -vvv

# 2. æµ‹è¯•é€šè¿‡åï¼Œè¿è¡Œæ‰€æœ‰ SimpleWallet çš„æµ‹è¯•
forge test --match-path test/SimpleWallet.t.sol

# 3. æœ€åè¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œç¡®ä¿æ²¡æœ‰ç ´åå…¶ä»–åŠŸèƒ½
forge test
```

### åœºæ™¯2ï¼šæŸä¸ªæµ‹è¯•å¤±è´¥äº†ï¼Œä½ æƒ³è°ƒè¯•

```bash
# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
forge test --match-test test_Prank_SimulateHacker_ShouldFail -vvvv

# è¾“å‡ºä¼šæ˜¾ç¤ºï¼š
# - å“ªä¸€è¡Œä»£ç å¤±è´¥äº†
# - revert çš„åŸå› 
# - gas ä½¿ç”¨æƒ…å†µ
# - è°ƒç”¨æ ˆ
```

### åœºæ™¯3ï¼šä½ æƒ³æµ‹è¯•æ‰€æœ‰ prank ç›¸å…³çš„åŠŸèƒ½

```bash
# è¿è¡Œæ‰€æœ‰ test_Prank å¼€å¤´çš„æµ‹è¯•
forge test --match-test "test_Prank.*" -vv
```

## âš ï¸ é‡è¦ç†è§£

### æµ‹è¯•éš”ç¦»æ€§

```solidity
contract SimpleWalletTest is Test {
    SimpleWallet public wallet;
    
    function setUp() public {
        wallet = new SimpleWallet(owner);
        vm.deal(address(wallet), 100 ether);
    }
    
    function test_1() public {
        // è¿™ä¸ªæµ‹è¯•å¼€å§‹æ—¶ï¼Œwallet æœ‰ 100 ETH
        wallet.withdraw(50 ether);
        // æµ‹è¯•ç»“æŸåï¼ŒçŠ¶æ€è¢«ä¸¢å¼ƒ
    }
    
    function test_2() public {
        // è¿™ä¸ªæµ‹è¯•å¼€å§‹æ—¶ï¼Œwallet åˆæœ‰ 100 ETHï¼ˆå› ä¸º setUp é‡æ–°æ‰§è¡Œäº†ï¼‰
        // test_1 çš„ä¿®æ”¹ä¸ä¼šå½±å“ test_2
    }
}
```

**å…³é”®ç‚¹ï¼šæ¯ä¸ªæµ‹è¯•éƒ½æ˜¯å®Œå…¨éš”ç¦»çš„ï¼**
- å°±åƒ Java ä¸­æ¯ä¸ª @Test æ–¹æ³•éƒ½ä¼šé‡æ–°åˆ›å»ºæµ‹è¯•ç±»å®ä¾‹
- setUp() å°±åƒ @BeforeEachï¼Œæ¯ä¸ªæµ‹è¯•å‰éƒ½ä¼šæ‰§è¡Œ

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

1. **å†™æµ‹è¯•æ—¶**ï¼šåªè¿è¡Œå½“å‰æµ‹è¯•
   ```bash
   forge test --match-test test_ä½ çš„æµ‹è¯•å -vvv
   ```

2. **æµ‹è¯•é€šè¿‡å**ï¼šè¿è¡Œç›¸å…³æµ‹è¯•
   ```bash
   forge test --match-path test/ä½ çš„æ–‡ä»¶.t.sol
   ```

3. **æäº¤å‰**ï¼šè¿è¡Œæ‰€æœ‰æµ‹è¯•
   ```bash
   forge test
   ```

## ğŸ“ æ€»ç»“

- âœ… **å¯ä»¥å•ç‹¬è¿è¡Œå•ä¸ªæµ‹è¯•**ï¼šä½¿ç”¨ `--match-test test_å‡½æ•°å`
- âœ… **æµ‹è¯•æ˜¯éš”ç¦»çš„**ï¼šæ¯ä¸ªæµ‹è¯•å‰éƒ½ä¼šé‡æ–° setUp()
- âœ… **ä¸€ä¸ªæ–‡ä»¶å¤šä¸ªæµ‹è¯•æ˜¯æ­£å¸¸çš„**ï¼šç±»ä¼¼ Java çš„æµ‹è¯•ç±»
- âœ… **å·¥ä½œä¸­å¸¸ç”¨**ï¼šå¼€å‘æ—¶åªè¿è¡Œå½“å‰æµ‹è¯•ï¼Œæäº¤å‰è¿è¡Œæ‰€æœ‰æµ‹è¯•
